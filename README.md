# Antifraud Detection Model

## Описание модели

Модель для обнаружения мошеннических транзакций на основе CatBoost. Модель анализирует паттерны поведения пользователей и характеристики транзакций для выявления потенциально мошеннических операций.

## Параметры обучения

### Основные гиперпараметры

| Параметр | Значение | Описание |
|----------|----------|----------|
| `iterations` | 1000 | Количество итераций обучения |
| `learning_rate` | 0.03 | Скорость обучения модели |
| `depth` | 6 | Глубина деревьев |
| `loss_function` | Logloss | Функция потерь для бинарной классификации |
| `eval_metric` | AUC | Метрика для оценки качества модели |
| `random_seed` | 30 | Seed для воспроизводимости результатов |
| `class_weights` | [1, 15] | Веса классов (1 - норма, 15 - мошенничество) |
| `l2_leaf_reg` | 5 | L2-регуляризация для предотвращения переобучения |
| `border_count` | 254 | Количество границ для разбиения признаков |
| `bagging_temperature` | 0.5 | Температура для Bayesian bootstrap |
| `min_data_in_leaf` | 20 | Минимальное количество наблюдений в листе |
| `threshold` | 0.4 | Порог для классификации (вероятность >= 0.4 → мошенничество) |

## Метрики производительности

- **Precision**: 0.3623 (36.23%)
- **Recall**: 0.7576 (75.76%)
- **F1-score**: 0.4902 (49.02%)
- **ROC-AUC**: 0.9870 (98.70%)

### Интерпретация метрик

- Высокий **Recall** (75.76%) означает, что модель успешно выявляет большинство мошеннических транзакций
- **ROC-AUC** (98.70%) показывает отличную способность модели разделять классы
- Относительно низкий **Precision** (36.23%) означает наличие ложных срабатываний, что приемлемо для антифрод-систем (лучше перепроверить, чем пропустить мошенничество)

## Feature Importance

Важность признаков по убыванию влияния на предсказания модели:

| № | Признак | Важность (%) |
|---|---------|--------------|
| 1 | `direction` | 38.91 |
| 2 | `amount` | 16.29 |
| 3 | `last_phone_model_categorical` | 5.02 |
| 4 | `burstiness_login_interval` | 3.54 |
| 5 | `logins_7d_over_30d_ratio` | 3.54 |
| 6 | `zscore_avg_login_interval_7d` | 3.53 |
| 7 | `last_os_categorical` | 3.28 |
| 8 | `monthly_os_changes` | 3.06 |
| 9 | `ewm_login_interval_7d` | 3.05 |
| 10 | `avg_login_interval_30d` | 2.76 |
| 11 | `freq_change_7d_vs_mean` | 2.57 |
| 12 | `login_frequency_7d` | 2.53 |
| 13 | `fano_factor_login_interval` | 2.49 |
| 14 | `login_frequency_30d` | 2.21 |
| 15 | `var_login_interval_30d` | 2.21 |
| 16 | `std_login_interval_30d` | 2.16 |
| 17 | `logins_last_30_days` | 1.13 |
| 18 | `logins_last_7_days` | 1.03 |
| 19 | `monthly_phone_model_changes` | 0.69 |

### Ключевые признаки

1. **Direction** (38.91%) - направление транзакции (самый важный признак)
2. **Amount** (16.29%) - сумма транзакции
3. **Last Phone Model** (5.02%) - модель телефона пользователя
4. **Burstiness Login Interval** (3.54%) - резкость изменений в интервалах входа

## SHAP Analysis

SHAP (SHapley Additive exPlanations) используется для интерпретации предсказаний модели на уровне отдельных транзакций.

### Важность признаков (SHAP)

![SHAP Feature Importance](shap_feature_importance.png)

Этот график показывает среднее абсолютное значение SHAP для каждого признака, что отражает общий вклад признака в предсказания модели.

### Распределение влияния признаков (SHAP Summary Plot)

![SHAP Summary Plot](shap_summary_plot.png)

Beeswarm plot показывает:
- **Положение точки по горизонтали** - SHAP value (влияние на предсказание)
- **Цвет точки** - значение признака (красный = высокое, синий = низкое)
- **Плотность точек** - частота появления определенных значений

Интерпретация:
- Высокие значения `direction` сильно увеличивают вероятность мошенничества (красные точки справа)
- Высокие значения `amount` также повышают риск
- Признаки поведения (`burstiness_login_interval`, `logins_7d_over_30d_ratio`) показывают, что аномальные паттерны активности связаны с мошенничеством

### Интерактивная визуализация

Подробная интерактивная визуализация SHAP values доступна в файле: **[shap_summary.html](shap_summary.html)**

SHAP анализ показывает:
- Какие признаки повлияли на конкретное предсказание
- Направление влияния (положительное/отрицательное)
- Величину вклада каждого признака

## Признаки модели

### Категориальные признаки
- `last_phone_model_categorical` - модель телефона
- `last_os_categorical` - операционная система
- `direction` - зашифрованный идентификатор получателя/destination транзакции

### Числовые признаки
- **Транзакционные**: `amount`
- **Поведенческие**: частота логинов, интервалы между логинами, изменения в поведении
- **Статистические**: средние, дисперсия, z-score, экспоненциально взвешенные средние

## Размер датасета

- **Train size**: 10,512 транзакций
- **Test size**: 2,628 транзакций

## Запуск обучения

Для обучения модели выполните:

```bash
python train_model.py
```

## Дата создания

Модель обучена: **2025-11-28T10:00:16.923943**
